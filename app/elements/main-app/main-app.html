<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-toolbar/paper-toolbar.html">
<link rel="import" href="../questions-list/questions-list.html">
<link rel="import" href="../../bower_components/paper-toast/paper-toast.html">
<link rel="import" href="../slide-builder/slide-builder.html">
<link rel="import" href="../property-editor/property-editor.html">
<link rel="import" href="../property-analyzer/property-analyzer.html">

<dom-module id="main-app">
  <template>
    <style>
      :host {
        display: block;
      }
      #toast{
      }

      #slide-container{
        position: absolute;
        top: 64px;
        left: 0;
        bottom: 0;
        right: 300px;
      }
      #nav-container{
        background: #fafafa;
        border-left: 1px solid #999;
        position: fixed;
        width: 300px;
        top: 0;
        right: 0;
        bottom: 0;
      }

    </style>

    <property-analyzer id="hydro"
      props={{_props}}
      src=[[_src]]>
    </property-analyzer>

    <paper-toolbar>
      <span class="title">question-editor-asq</span>
    </paper-toolbar>

    <section id="slide-container">
      <slide-builder id="slideBuilder"
        dropped-elem={{dropped}}
        is-dragging={{isDragging}}>
      </slide-builder>
    </section>

    <nav id="nav-container">
      <questions-list id="questions-list"></questions-list>
      <property-editor props=[[_props]]></property-editor>

    </nav>

    <paper-toast id="toast" text={{toastMessage}} duration='3000' ></paper-toast>

  </template>
  <script>
    Polymer({
      is: 'main-app',
      listeners:{
        "fireToast": "openToast",
        "dragStart": "_dragStart",
        "dragStop" : "_dragStop",
        "changeSelection": "_changeSrc",
        "changeProp": "_changeProp"
      },

      properties: {
        toastMessage: {
          type: String,
          value: ''
        },
        isDragging: {
          type: Boolean,
          value: false
        },
        dropped: {
          type: Object,
          notify: true
        },
        _src: {
          type: String,
          value:''
        },
        _props: {
          type: Array
        }
      },

      openToast: function (host, messageData) {
        this.toastMessage = messageData.text;
        this.$.toast.open();
      },
      _dragStart: function(host){
        this.isDragging = true;
      },
      _dragStop: function (host, droppedElem) {

        this.isDragging = false;
        if (droppedElem) {
          // render the dropped element
          this.dropped = droppedElem;
        }
      },

      _changeSrc: function (host, newSrc) {
        if (newSrc == '') {
          this._src = '';
        }else{
          this._src = '../../bower_components/'+ newSrc +'/'+ newSrc + '.html';
        }
      },

      _changeProp: function (host, prop) {
        var scope = this.$.slideBuilder;
        scope.$$('wrapper-selector').changeChildProp(prop);
      }
    });
  </script>
</dom-module>
