<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-toolbar/paper-toolbar.html">
<link rel="import" href="../qea-questions-list/qea-questions-list.html">
<link rel="import" href="../../bower_components/paper-toast/paper-toast.html">
<link rel="import" href="../qea-canvas/qea-canvas.html">
<link rel="import" href="../qea-feature-editor/qea-feature-editor.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../bower_components/paper-tooltip/paper-tooltip.html">
<link rel="import" href="../qea-property-analyzer/qea-property-analyzer.html">

<dom-module id="qea-main-app">
  <template>
    <style>
      :host {
        display: block;
      }
      #toast{
      }

      paper-toolbar{
        --paper-toolbar-background: white;
        --paper-toolbar-color: black;
        --paper-toolbar-title: {
          min-width: 230px;
          flex-grow : 0;
        }
      }

      #canvas-container{
        position: absolute;
        top: 64px;
        left: 0;
        bottom: 0;
        right: 300px;
      }
      #nav-container{
        background: #fafafa;
        border-left: 1px solid #999;
        position: fixed;
        width: 300px;
        top: 0;
        right: 0;
        bottom: 0;
      }
      .tollbarIcon{
        margin: 0 10px;
        color: grey;
      }

    </style>

    <qea-property-analyzer props='{{props}}'></qea-property-analyzer>

    <paper-toolbar justify='start' >
      <span class="title">question-editor-asq  </span>
      <paper-icon-button icon="code" class="tollbarIcon" on-tap='logCode' id='code'></paper-icon-button>
      <paper-tooltip for="code">log canvas code</paper-tooltip>

      <!-- <paper-icon-button icon="save" class="tollbarIcon" id='save'></paper-icon-button>
      <paper-tooltip for="save">save (not implemented)</paper-tooltip> -->

    </paper-toolbar>

    <section id="canvas-container">
      <qea-canvas id="qeaCanvas"
        dropped-elem={{dropped}}
        prop-to-change=[[_propToChange]]
        is-dragging={{isDragging}}>
      </qea-canvas>
    </section>

    <nav id="nav-container">
      <qea-questions-list id="questions-list"></qea-questions-list>
      <qea-feature-editor prop-array={{props}}></qea-feature-editor>
    </nav>

    <paper-toast id="toast" text={{toastMessage}} duration='3000' ></paper-toast>

  </template>
  <script>
  (function() {
    'use strict';

    class qeaMainApp {
      beforeRegister() {
        this.is = 'qea-main-app';

        this.listeners = {
          "fireToast": "openToast",
          "dragStart": "_dragStart",
          "dragStop" : "_dragStop",
          "changeProp": "_changeProp"
        },

        this.properties = {
          toastMessage: {
            type: String,
            value: ''
          },
          isDragging: {
            type: Boolean,
            value: false
          },
          dropped: {
            type: Object,
            notify: true
          },
          _propToChange: {
            type: Object,
            value: ()=>null
          },
          props: {
            type: Object,
            notify: true
          }
        }
      }
      openToast(host, messageData) {
        this.toastMessage = messageData.text;
        this.$.toast.open();
      }

      _dragStart(host){
        // receive the event from question-item when drag start
        this.isDragging = true;
      }

      _dragStop(host, droppedElem) {
        // receive the event from question-item when drag stop
        this.isDragging = false;
        if (droppedElem) {
          // render the dropped element
          this.dropped = droppedElem;
        }

      }

      _changeProp(host,editedProp){
        this._propToChange = editedProp;
      }

      logCode(){
        console.log(this.$.qeaCanvas.$.canvas);
        this.openToast(null, {text: 'open console'})
      }


    }
    Polymer(qeaMainApp);
  })();

  </script>
</dom-module>
