<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-material/paper-material.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-checkbox/paper-checkbox.html">
<link rel="import" href="../../bower_components/Sortable/Sortable.html">
<link rel="import" href="../../behaviors/qea-inspect-behavior.html">
<link rel="import" href="../qea-selector-highlighter/qea-selector-highlighter.html">


<dom-module id="qea-canvas">
  <template>
    <style>
      :host {
        display: block;
        height: 100%;
        width: calc(100% - 300px);
        box-sizing: border-box;

        padding: 5px;
      }
      #canvas{
        width: 100%;
        height: 100%;
        position: relative;
      }

    </style>
    <div id="canvas" on-tap='selectItem'>
      <sortable-js handle=".handle" scroll  animation='200' force-Fallback='true'>
        <template is="dom-repeat" items={{objs}}  >
          <qea-selector-highlighter
            selected-Id=[[selectedElemId]]
            element-Id=[[item.id]]
            content=[[item.html]]>
          </qea-selector-highlighter>
        </template>
      </sortable-js>
    </div>

  </template>
  <script>
  (function () {
    'use strict'

    let MyBehavior = {};
    class qeaCanvas {

      get behaviors() {
        return [qeaBehaviors.inspectBehavior];
      }

      beforeRegister(){
        this.is = 'qea-canvas'
        this.properties = {
          isDragging:{
            type: Boolean
          },
          selectedElemId:{
            type:String
          },
          objs:{
            type: Array,
            value: ()=>[
              {id: 3, html:'<h1>title</h1>'},
              {id: 4, html:'<h1>gatto</h1>'},
              {id: 5, html:'<h1>pardo</h1>'}
            ]
          }
        }
      }

      selectItem(event){
        for (var value of event.path) {
          if(value.tagName && value.tagName.toLowerCase() === "qea-selector-highlighter"){
            this.selectedElemId = value.elementId
            return
          }
        }
        this.selectedElemId = null;
      }

      _importElement(elementName, notyfyImport=true){
      // check if the element is already been imported
        if (!this.$$(elementName)){
          Polymer.Base.importHref(this.resolvePath(elementName),
            ()=>{ if (notyfyImport){this._message(elementName+ ' imported')} },
            ()=> {this._message('error while importing: '+ elementName); return 0}
          )
        }
        return 1;
      }



      _message(message){
        this.fire('fireToast', {text: message})
      }



      // generate a random id
      idGenerator(){
        let S4 = function() {
          return (((1+Math.random())*0x10000)|0).toString(16).substring(1);
        };
        return (S4()+S4()+"-"+S4()+"-"+S4()+"-"+S4()+"-"+S4()+S4()+S4());
      }





    }

    Polymer(qeaCanvas);
  })()

  </script>
</dom-module>
