<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/qea-property-editor/qea-property-editor-repeater.html">
<link rel="import" href="../../bower_components/qea-property-editor/qea-property-editor.html">
<link rel="import" href="../../bower_components/asq-multi-choice-q/asq-multi-choice-q.html">
<link rel="import" href="../qea-general-layouts/qea-three-column-layout.html">
<link rel="import" href="../../bower_components/asq-option/asq-option.html">
<link rel="import" href="../../bower_components/qea-property-editor/qea-advanced-editors.html">
<link rel="import" href="./qea-options-editor.html">

<dom-module id="asq-multi-choice-q-editor">
  <template>
    <style include="qea-three-column-layout"></style>
    <style>

    </style>

    <!-- leftPanel -->
    <div id="leftPanel">


      <!-- title property-->
      <qea-property-editor
        name='title'
        label="question Title"
        type='string'
        default='Title'
        value={{qTitleVal}}>
      </qea-property-editor>

      <!-- description property-->
      <qea-property-editor
        name='Question Description'
        type='string'
        widget-Type='text-code'
        default={{qDescVal}}
        value={{qDescVal}}>
      </qea-property-editor>


      <div class="sectionTitle"> option list </div>
      <qea-options-editor
        reset=[[_optionsSetter]]
        value={{_optionsValue}}>
      </qea-options-editor>

      <div class="sectionTitle">
        qestion properties
      </div>
      <!-- list of question properties -->
      <qea-property-editor-repeater id="propertyRepeater"
        property-Array={{questionProps]]
        values={{propValues}}
        is-Advanced-User=[[viewAdvanced]]>
      </qea-property-editor-repeater>

      <div id="advanced" on-tap="_showAdvanced">
        show all
      </div>

    </div>

    <!-- Main Area -->
    <div id="mainArea">
      <div class="explanation">
        To modify the elements in this area, change the values in the left column
      </div>

      <asq-multi-choice-q id='multyQuestion'
        multi=[[propValues.multi]]
        disabled=[[propValues.disabled]]
        value={{propValues.value}}
        selected-Class=[[propValues.selectedClass]]
        selected=[[propValues.selected]]
        selectable=[[propValues.selectable]]>

        <asq-stem><span id="stemContent" inner-H-t-m-l={{qTitleVal}}></span></asq-stem>
        <div id='questionDescription' inner-H-t-m-l={{qDescVal}}></div>

        <template is="dom-repeat" items="[[_optionsValue]]">
          <asq-option name=[[item.label]]>[[item.label]]</asq-option>
        </template>
        <!-- <asq-option name='1'>1</asq-option>
        <asq-option name='2'>2</asq-option> -->


        <asq-solution hidden>[[solution]]</asq-solution>
      </asq-multi-choice-q>

      <div class="controlPanel">
        <paper-button raised id="solutionBt" on-tap='_setSolution' noink>[[_solutionBt]]</paper-button>
        <paper-button raised on-tap='_saveQuestion'>save</paper-button>
      </div>
    </div>

    <!-- Right Panel -->
    <div id="rightPanel">

    </div>

  </template>
  <script>
  (function () {
    'use strict'

    let questionProperties=[
      {
        name: "multi",
        label: "multiple answer",
        type: "boolean", //< Boolean | Number | String | Enum  >
        description: `Decide the mode, single or multi.`,
        default: "false"
      },
      {
        name: "disabled",
        type: "boolean", //< Boolean | Number | String | Enum  >
        description: `Disable or enable the element. Changes will be also propagated to inner propagated elements.`,
        default: "false"
      },
      {
        name: "selectable",
        label: "Specify selectable elements",
        type: "string", //< Boolean | Number | String | Enum  >
        description: `This is a CSS selector sting.  If this is set, only items that matches the CSS selector are selectable.`,
        isAdvancedProperty: "true"
      },
      {
        name: "selected",
        type: "string", //< Boolean | Number | String | Enum  >
        description: `Gets or sets the selected element. The default is to use the index of the item.`,
        isAdvancedProperty: "true"
      },
      {
        name: "selectedClass",
        type: "String", //< Boolean | Number | String | Enum  >
        description: `The class to set on elements when selected.`,
        default: "asq-selected",
        isAdvancedProperty: "true"
      },
    ]
    class asqMultiChoiceQEditor {

      get behaviors() {
        return [];
      }

      beforeRegister(){
        this.is = 'asq-multi-choice-q-editor'
        this.observers= [
          '_modifyOptions(_optionsValue.splices)'
        ]
        this.properties = {
          questionId:{
            type: String,
            value: null
          },
          questionProps: {
            type: Array,
            value: questionProperties
          },
          propValues: {
            type: Object
          },
          viewAdvanced:{
            type:String,
            value: 'false'
          },
          restoreState:{
            type: Object,
            observer: '_restoreQuestionState'
          },
          _solutionBt:{
            type: String,
            value: 'set solution'
          },
          _optionsValue:{
            type: Array,
            value:()=>[]
          },
          qTitleVal:String,
          qDescVal: String,
          qSolVal:String,
          _optionsSetter: Array

        }
      }

      ready() {
        this.async(()=>{
          let el = Polymer.Base.create('qea-advanced-editors', {});
          Polymer.dom(this.$.leftPanel).appendChild(el);
        }, 200)

      }

      _showAdvanced(){
        this.viewAdvanced = this.viewAdvanced == 'true' ? 'false': 'true';
        this.$.advanced.textContent = this.viewAdvanced == 'true' ? 'hide advanced': 'show all';
      }
      //
      // _modifyOptions(optionsList){
      //   console.log(optionsList);
      //   let oldEditors = Polymer.dom(this.$.optionsList).childNodes
      //   for (let edit of oldEditors) {
      //     Polymer.dom(this.$.optionsList).removeChild(edit)
      //   }
      //   let a = document.createElement("div");
      //   for (let opt of this._optionsValue) {
      //     let el = Polymer.Base.create('asq-option', {name:opt.label});
      //     let div = document.createTextNode(opt.label)
      //     Polymer.dom(el).appendChild(div)
      //     Polymer.dom(a).appendChild(el)
      //   }
      //   Polymer.dom(this.$.optionsList).appendChild(a)
      //
      // }

      _saveQuestion(){
        
      }
    }

    Polymer(asqMultiChoiceQEditor);
  })()
  </script>
</dom-module>
