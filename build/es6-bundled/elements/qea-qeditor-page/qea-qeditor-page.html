<html><head></head><body><dom-module id="qea-qeditor-page"><template><style include="iron-flex">:host{display:block;}</style><app-route query-params="{{query}}" route="{{route}}" pattern="/:qid/edit" data="{{routeData}}"></app-route><iron-localstorage name="my-app-storage" value="{{exerciseStore}}"></iron-localstorage><div id="editorContainer" class="flex layout horizontal"></div></template><script>(function(){'use strict';Polymer({is:'qea-qeditor-page',behaviors:[qeaBehaviors.appBehavior,qeaBehaviors.actionsBehavior,qeaBehaviors.reduxStore],observers:['_questionChanged(routeData.qid, query.type)'],properties:{exerciseStore:{type:Object,notify:!0},route:{type:Object,notify:!0},routeData:{type:Object,notify:!0},query:{type:Object,notify:!0}},_questionChanged:function(a,b){this.debounce('changeQuestion',()=>{this.$$('iron-localstorage').reload();const c=`${b}-editor`;if(!(a&&this.exerciseStore))''===a&&this.set('route.path','404');else if('new'===a){this.dispatch('addElement',b,null,{});const a=this.getState().elements.slice(-1)[0].id;this.set('exerciseStore.elements',this.getState().elements),this.set('routeData.qid',a)}else this.fire('toggleSpinner',!0),this._clearPage(),Polymer.Base.importHref(this.__resolveLocalPath(c),()=>{this._renderEditor(a,c,this.query.eid)},()=>{this.fire('toggleSpinner',!1),this.fire('fireToast',{text:'We can\'t find that editor',type:'error'}),this.fire('changePage',{pageURL:'404'})},!0)})},_renderEditor:function(a,b,c){let d=null;if(a&&(d=this._searchQuestion(a),!d))return this.fire('toggleSpinner',!1),void this.fire('fireToast',{text:'We can\'t find that question',type:'error'});const e=Polymer.Base.create(b,{id:a,exerciseId:c,restoreState:d});e.classList.add('flex'),this.async(()=>{Polymer.dom(this.$.editorContainer).appendChild(e),this.fire('toggleSpinner',!1)},1e3)},_searchQuestion:function(a){if(this.exerciseStore)for(const b of this.exerciseStore.elements)if(b.id===a)return b.props;return null},_clearPage:function(){const a=Polymer.dom(this.$.editorContainer).childNodes;for(const b of a)Polymer.dom(this.$.editorContainer).removeChild(b)}})})();</script></dom-module></body></html>