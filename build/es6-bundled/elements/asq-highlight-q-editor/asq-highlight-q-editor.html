<html><head><link rel="import" href="../../bower_components/polymer/polymer.html"><link rel="import" href="../../bower_components/iron-dropdown/iron-dropdown.html"><link rel="import" href="../../bower_components/iron-flex-layout/classes/iron-flex-layout.html"><link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html"><link rel="import" href="../../bower_components/iron-icons/iron-icons.html"><link rel="import" href="../../bower_components/paper-dialog/paper-dialog.html"><link rel="import" href="../../bower_components/paper-dropdown-menu/paper-dropdown-menu.html"><link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html"><link rel="import" href="../../bower_components/paper-input/paper-input.html"><link rel="import" href="../../bower_components/paper-input/paper-textarea.html"><link rel="import" href="../../bower_components/paper-item/paper-item.html"><link rel="import" href="../../bower_components/paper-menu/paper-menu.html"><link rel="import" href="../../bower_components/paper-toggle-button/paper-toggle-button.html"><link rel="import" href="../../bower_components/paper-toolbar/paper-toolbar.html"><link rel="import" href="./asq-highlight-q-editor-styles.html"><link rel="import" href="../../bower_components/asq-highlight-q/asq-highlight-q.html"><link rel="import" href="../../bower_components/asq-highlight-q/elements/asq-hl-color-task/asq-hl-color-task.html"><link rel="import" href="../../bower_components/asq-highlight-q/elements/color-palette.html"><link rel="import" href="../../behaviors/qea-redux-store.html"><link rel="import" href="../../behaviors/qea-actions-behavior.html"><link rel="import" href="../qea-common-editor-components/qea-editors-behavior.html"><link rel="import" href="../qea-common-editor-components/qea-user-response.html"></head><body><dom-module id="asq-highlight-q-editor"><template><style include="asq-highlight-q-editor-styles"></style><style>:host{@apply (--layout-vertical);}#newTaskContainer{@apply (--layout-horizontal);@apply (--layout-end);}#newTaskTextarea{@apply (--layout-flex);}.ptb-margin{margin:0 8px;}</style><qea-user-response></qea-user-response><paper-toolbar><paper-icon-button icon="save" title="Save" id="saveBtn" on-click="_saveQt"></paper-icon-button><paper-icon-button icon="clear" title="cancell" id="cancelBt" on-tap="_cancel"></paper-icon-button><span class="separator"></span><paper-input class="ptb-margin" label="font-size" value="{{fontSize}}"></paper-input><paper-dropdown-menu class="ptb-margin" label="Syntax"><paper-menu class="dropdown-content" id="syntaxMenu" selected-item="{{syntaxModeItem}}"><template is="dom-repeat" items="{{syntaxModes}}" as="mode"><paper-item file$="[[mode.file]]">[[mode.name]]</paper-item></template></paper-menu></paper-dropdown-menu>&nbsp;<paper-dropdown-menu class="ptb-margin" label="Theme"><paper-menu class="dropdown-content" id="themeMenu" selected-item="{{themeItem}}"><template is="dom-repeat" items="{{themes}}" as="t"><paper-item file$="[[t.file]]">[[t.name]]</paper-item></template></paper-menu></paper-dropdown-menu><span class="separator"></span> <span id="editLabel" on-click="_setModeFromLabel" class$="{{_isEditLabelActive(mode)}}">Edit Text</span><paper-toggle-button id="toggleBtn" on-change="_toggleMode" on-iron-change="_toggleMode"></paper-toggle-button><span id="highlightLabel" on-click="_setModeFromLabel" class$="{{_isHighlightLabelActive(mode)}}">Highlight</span><div class="flex"></div><h5><code style="padding: 4px 0 3px;">&lt;asq-highlight-q&gt;</code> <span style="color:#666;">editor</span></h5></paper-toolbar><section id="elementConf"><paper-textarea id="stemTextarea" label="Stem (HTML is allowed; use responsibly)" value="{{stemTextareaValue}}"></paper-textarea><div id="newTaskContainer"><paper-textarea id="newTaskTextarea" label="Task description (HTML is allowed"></paper-textarea><color-palette id="colorPalette" selected="0"></color-palette><paper-input id="colorName" label="colorName"></paper-input>&nbsp; &nbsp;<paper-icon-button icon="add-box" id="addTask" on-click="_addTask">Create task</paper-icon-button></div></section><paper-dialog id="sameColorDialog" layered="false"><p>You already have a task with this color!</p><div class="buttons"><paper-button dialog-confirm="" autofocus="">CLOSE</paper-button></div></paper-dialog><paper-dialog id="markupDialog" on-core-overlay-open-completed="coreOverlayOpenCompleted" backdrop="" layered="false"><div id="aceContainer"><ace-element id="markupEditor" theme="textmate" mode="xml"></ace-element></div><div class="buttons"><paper-button dialog-confirm="" autofocus="">CLOSE</paper-button></div></paper-dialog><br><br><br><br><asq-highlight-q id="asqHighlight" theme="{{theme}}" mode="{{syntaxMode}}" font-size="{{fontSize}}"><asq-stem id="leStem"></asq-stem><template is="dom-repeat" items="{{tasks}}" as="t" index-as="idx"><asq-hl-color-task color="{{t.color}}" idx$="{{idx}}" color-name="{{t.colorName}}">{{t.html}}<paper-icon-button icon="close" on-click="removeTask" data-for-idx$="{{idx}}"></paper-icon-button></asq-hl-color-task></template></asq-highlight-q></template><script>(function(){var a=[{file:'coffee',name:'CoffeeScript'},{file:'c_cpp',name:'C/C++'},{file:'css',name:'CSS'},{file:'html',name:'HTML'},{file:'jade',name:'Jade'},{file:'java',name:'Java'},{file:'javascript',name:'Javascript'},{file:'json',name:'JSON'},{file:'less',name:'LESS'},{file:'lisp',name:'LISP'},{file:'php',name:'PHP'},{file:'python',name:'Python'},{file:'ruby',name:'Ruby'},{file:'sass',name:'SASS'},{file:'scss',name:'SCSS'},{file:'sql',name:'SQL'},{file:'xml',name:'XML'},{file:'yaml',name:'YAML'}],b=[{file:'chrome',name:'Chrome'},{file:'clouds',name:'Clouds'},{file:'crimson_editor',name:'Crimson Editor'},{file:'dawn',name:'Dawn'},{file:'dreamweaver',name:'Dreamweaver'},{file:'eclipse',name:'Eclipse'},{file:'gitHub',name:'GitHub'},{file:'solarized_light',name:'Solarized Light'},{file:'textmate',name:'TextMate'},{file:'tomorrow',name:'Tomorrow'},{file:'xcode',name:'XCode'},{file:'kuroir',name:'Kuroir'},{file:'katzenmilch',name:'KatzenMilch'},{file:'ambiance',name:'Ambiance'},{file:'chaos',name:'Chaos'},{file:'clouds_midnight',name:'Clouds Midnight'},{file:'cobalt',name:'Cobalt'},{file:'idle_fingers',name:'idle Fingers'},{file:'kr_theme',name:'krTheme'},{file:'merbivore',name:'Merbivore'},{file:'merbivore_soft',name:'Merbivore Soft'},{file:'mono_industrial',name:'Mono Industrial'},{file:'monokai',name:'Monokai'},{file:'pastel_on_dark',name:'Pastel on dark'},{file:'solarized_dark',name:'Solarized Dark'},{file:'terminal',name:'Terminal'},{file:'tomorrow_night',name:'Tomorrow Night'},{file:'tomorrow_night_blue',name:'Tomorrow Night Blue'},{file:'tomorrow_night_bright',name:'Tomorrow Night Bright'},{file:'tomorrow_night_eighties',name:'Tomorrow Night 80s'},{file:'twilight',name:'Twilight'},{file:'vibrant_ink',name:'Vibrant Ink'}];Polymer({is:'asq-highlight-q-editor',properties:{stem:{type:String,value:'',notify:!0},mode:{type:String,notify:!0},stemTextareaValue:{observer:'_stemTextareaChanged',notify:!0},syntaxModeItem:{observer:'_syntaxModeItemChanged',notify:!0},syntaxModes:{type:Array,value:function(){return a},notify:!0},syntaxMode:{type:String,value:'',notify:!0},themes:{type:Array,value:function(){return b},notify:!0},theme:{type:String,value:'',notify:!0},tasks:{type:Array,value:function(){return[]}},themeItem:{observer:'_themeItemChanged',notify:!0}},behaviors:[qeaBehaviors.actionsBehavior,qeaBehaviors.reduxStore,qeaBehaviors.generalEditorsBehavior],observers:['_tasksChanged(tasks, asqHighlight)'],attached:function(){this.colors=Object.create(null),this.asqHighlight=Polymer.dom(this.$.asqHighlight.root).querySelector('asq-highlight-viewer-q'),this.aceHighlightManager=this.asqHighlight.$.aceHighlightManager,setTimeout(function(){this._setMode('edit_text'),this.initialized=!0}.bind(this),1)},_syntaxModeItemChanged:function(a,b){a&&a!=b&&(this.syntaxMode=this.syntaxModeItem.getAttribute('file'))},_toggleMode:function(a){this.initialized&&(a.currentTarget.checked?this._setMode('highlight'):this._setMode('edit_text'))},_setMode:function(a){if('highlight'==a)this.mode='highlight',this.aceHighlightManager.mode=this.aceHighlightManager.MODE_HIGHLIGHT;else if('edit_text'==a)this.mode='edit_text',this.aceHighlightManager.mode=this.aceHighlightManager.MODE_EDIT_TEXT;else throw Error('invalid mode')},_themeItemChanged:function(a,b){a&&a!=b&&(this.theme=this.themeItem.getAttribute('file'))},_addTask:function(){var a=this.$.colorPalette.selectedColor.color;if(this.colors[a])return void this.$.sameColorDialog.toggle();this.colors[a]=!0;var b=this.$.colorName.value||'';b=b.trim()||a;var c=this.$.newTaskTextarea.value||'';c=c.trim()||'Task #'+(this.tasks.length+1),this.push('tasks',{color:a,colorName:b,html:c}),Polymer.dom.flush(),this.asqHighlight._populatePalette()},_tasksChanged:function(a,b){b.palette=a.map(function(a){return{color:a.color,name:a.colorName}}.bind(this))},removeTask:function(a){var b=parseInt(a.currentTarget.dataset.forIdx),c=this.$$('[idx="'+b+'"]');delete this.colors[c.color],this.splice('tasks',b,1),this.aceHighlightManager.removeMarkersByColor(c.color),setTimeout(this.asqHighlight._populatePalette.bind(this.asqHighlight),1)},_stemTextareaChanged:function(){this.stem=this.$.stemTextarea.value,this.$.leStem.innerHTML=this.stem},coreOverlayOpenCompleted:function(){this.$.markupEditor.editor.resize()},getRanges:function(){return this.aceHighlightManager.getHighlightRanges()},_getFormattedCode:function(){var a='\t<asq-highlight-q style="min-height:300px"';return a+='\ttheme="'+this.theme+'" ',a+='\tfont-size="'+this.fontSize+'" ',a+='\tmode="'+this.syntaxMode+'">\n',a+='  \t\t<asq-solution>'+JSON.stringify(this.getRanges(),null,2)+'</asq-solution>\n',a+='    \t\t<asq-stem>'+this.stem+'</asq-stem>\n',this.tasks.forEach(function(b){a+='   \t\t<asq-hl-color-task color="'+b.color+'" colorName="'+b.colorName+'">'+b.html+'</asq-hl-color-task>\n'}),a+='   \t\t<code>',a+=this.asqHighlight.$.codeEditor.editor.session.getValue()||'',a+='\t\t</code>\n',a+='  \t</asq-highlight-q>\n',a},_setModeFromLabel:function(a){this.$.toggleBtn.checked='highlightLabel'==a.currentTarget.id},_saveQt:function(){var a=JSON.stringify(this.getRanges(),null,2);this.questionSolution=a,this._saveQuestion(['stem'])},_isEditLabelActive:function(a){return'edit_text'==a?'active':''},_isHighlightLabelActive:function(a){return'highlight'==a?'active':''}})})();</script></dom-module></body></html>