<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../bower_components/iron-localstorage/iron-localstorage.html">
<link rel="import" href="../../bower_components/paper-card/paper-card.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../../bower_components/app-route/app-location.html">
<link rel="import" href="../qea-common-editor-components/qea-user-response.html">

<dom-module id="qea-landing-page">
  <template>
    <style>
      :host {
        display: block;
        @apply(--layout-horizontal);
      }
      .container{
        position: relative;
        @apply(--layout-flex);
      }
      .container paper-fab{
        position: absolute;
        color: black;
        --paper-fab-background: white;
        right: 40px;
        bottom: 40px;
      }
      #fabButton{
        --paper-fab-background:#7CB342;
        color: white;
      }
      .card{
        margin: 20px;
      }
      #remove{
        color: #f44336
      }

      .tiles-container {
        height: 100%;
        @apply(--layout-vertical);
      }

      .tiles-row {
        @apply(--layout-horizontal);
        @apply(--layout-around-justified);
        /*@apply(--layout-center);*/
        @apply(--layout-flex);
        padding: 1.5vh 0;
      }

      .tile {
        @apply(--layout-flex);
        @apply(--layout-vertical);
        @apply(--layout-justified);
        @apply(--layout-center);
        text-align: center;
        padding: 10px;
        margin: 2vh 4vw;
        box-shadow: 0 6px 12px rgba(0,0,0,0.3),
        0 0 4px 4px transparent,
        inset 0 0 10px rgba(0,0,0,0.1);
        transition: box-shadow 100ms ease-in;
        cursor: pointer;
      }

      .tile:first-child{
        margin-left: 8vh;
      }

      .tile:last-child{
        margin-right: 8vh;
      }

      .tile:hover{
        box-shadow: 0 6px 12px rgba(0,0,0,0.3),
                0 0 4px 4px #7CB342,
                inset 0 0 10px rgba(0,0,0,0.1);
      }

      .tile img {
        max-height: calc(100% - 50px);
        max-width: calc(100% - 50px);
      }


    </style>
    <app-location route="{{route}}" ></app-location>
    <qea-user-response id="notify"></qea-user-response>

    <iron-localstorage name="my-app-storage"
      value="{{exerciseStore}}">
    </iron-localstorage>
    <div class="container">
      <template is="dom-if" if="[[_checkStore(exerciseStore)]]">
        <paper-card  class="card" >
          <div class="card-content">
            <p>
              we have foud a presentation<br> do
              you whant to restore it?
            </p>
          </div>
          <div class="card-actions">
            <paper-button id="remove" on-tap="_remove">remove</paper-button>
            <paper-button id="restore" on-tap="_restore">restore</paper-button>
          </div>
        </paper-card>
      </template>



      <div class="tiles-container">

        <div class="tiles-row">
          <div data-qtype="asq-text-input-q" class="tile" on-tap="_getEditor">
            <img src="../../question-screens/asq-text-input-q-viewer.jpg"/>
            <h2>Text input</h2>
          </div>

          <div data-qtype="asq-multi-choice-q" class="tile" on-tap="_getEditor">
            <img src="../../question-screens/asq-multi-choice-q-viewer.jpg"/>
            <h2>Multichoice</h2>
          </div>

          <div data-qtype="asq-highlight-q" class="tile" on-tap="_getEditor">
            <img src="../../question-screens/asq-highlight-q-viewer.jpg"/>
            <h2>Highlight the Text</h2>
          </div>
        </div>

        <div class="tiles-row">
          <div data-qtype="asq-buckets-q" class="tile" on-tap="_getEditor">
            <img src="../../question-screens/asq-buckets-q-viewer.jpg"/>
            <h2>Classify</h2>
          </div>

          <div data-qtype="asq-order-q" class="tile" on-tap="_getEditor">
            <img src="../../question-screens/asq-order-q-viewer.jpg"/>
            <h2>Order</h2>
          </div>

          <div data-qtype="asq-css-select-q" class="tile" on-tap="_getEditor">
            <img src="../../question-screens/asq-css-select-q-viewer.jpg"/>
            <h2>CSS Select</h2>
          </div>
        </div>

        <div class="tiles-row">
          <div data-qtype="asq-js-function-body-q" class="tile" on-tap="_getEditor">
            <img src="../../question-screens/asq-js-function-body-q-viewer.jpg"/>
            <h2>JavaScript function</h2>
          </div>
          <div data-qtype="asq-rating-q" class="tile" on-tap="_getEditor">
            <img src="../../question-screens/asq-rating-q-viewer.jpg"/>
            <h2>Rating</h2>
          </div>
          <div data-qtype="asq-sqlite-q" class="tile" on-tap="_getEditor">
            <img src="../../question-screens/asq-sqlite-q-viewer.jpg"/>
            <h2>SQLite</h2>
          </div>
        </div>
      </div>

      <!-- <paper-fab id="fabButton" icon="add" on-tap="_newExercise"></paper-fab> -->
    </div>

  </template>
  <script>
  (function () {
    'use strict';

    Polymer({

      is: 'qea-landing-page',
      properties: {
        exerciseStore: {
          type: Object,
          value: () => { return {}; },
        },
        /**
        * Route
        */
        route:{
          type: Object,
          notify: true,
        },
      },

      // go to new page
      _newExercise: function() {
        if (this._checkStore(this.exerciseStore)) {
          this.$.notify.notifyConfirm('Warning', 'if you continue presentation will be overridden')
            .then((responce) => {
              if (responce) {
                this.fire('changePage', { pageURL: '/exercise/new' });
              }
            });
        } else {
          this.fire('changePage', { pageURL: '/exercise/new' });
        }
      },

      // go to question editor
      _getEditor: function(el) {
        let questionType = el.target.dataset.qtype;
        if(questionType == undefined || questionType == '') {
          questionType = el.target.parentNode.dataset.qtype;
        }
        this.fire('changePage',
          { pageURL: '/question/new/edit',
            qParams: { type: questionType, eid: this.exerciseId },
          }
        );
      },

      _checkStore: function(store = {}) {
        if (store && store.elements) {
          return (store.elements.length > 0);
        }
        return false;
      },

      _restore: function() {
        this.fire('changePage', { pageURL: `/exercise/${ this.exerciseId }` });
      },

      _remove: function() {
        this.exerciseStore = {};
      }
    });

  })();
  </script>
</dom-module>
